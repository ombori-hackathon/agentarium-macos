#!/bin/bash
set -e

echo "Running pre-commit checks..."

# Get the list of staged Swift files
STAGED_SWIFT_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.swift$' || true)

if [ -z "$STAGED_SWIFT_FILES" ]; then
    echo "No Swift files staged, skipping checks."
    exit 0
fi

echo "Checking Swift files:"
echo "$STAGED_SWIFT_FILES"

# Check formatting (lint mode - doesn't modify files)
echo ""
echo "Checking formatting..."
if ! swift format lint --strict --recursive Sources/; then
    echo ""
    echo "Formatting issues found. Run 'make format' to fix them."
    exit 1
fi

# Build to check for errors (warnings are OK - SceneKit has Sendable issues in Swift 6)
echo ""
echo "Building..."
if ! swift build 2>&1; then
    echo "Build failed!"
    exit 1
fi

echo ""
echo "All checks passed!"
